<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10 col-md-12">
      <div class="card job-card p-5 shadow-lg">
        <div class="card-body">
          <% if(locals.job){ %>
          <h1 class="display-4 fw-bold text-warning mb-2">
            <%= job.companyname%>
          </h1>
          <h2 class="h4 text-white mb-4"><%= job.jobdesignation%></h2>

          <div class="row mb-4">
            <div class="col-md-6 mb-3">
              <p class="text-white-50 mb-1">
                <i class="fa-solid fa-location-dot me-2"></i>Location:
              </p>
              <p class="fw-bold text-white fs-5"><%= job.joblocation%></p>
            </div>
            <div class="col-md-6 mb-3">
              <p class="text-white-50 mb-1">
                <i class="fa-solid fa-money-bill-wave me-2"></i>Salary:
              </p>
              <p class="fw-bold text-white fs-5"><%= job.salary%></p>
            </div>
            <div class="col-md-6 mb-3">
              <p class="text-white-50 mb-1">
                <i class="fa-solid fa-users me-2"></i>Total Positions:
              </p>
              <p class="fw-bold text-white fs-5"><%= job.numberofopenings%></p>
            </div>
            <div class="col-md-6 mb-3">
              <p class="text-white-50 mb-1">
                <i class="fa-solid fa-briefcase me-2"></i>Job Category:
              </p>
              <p class="fw-bold text-white fs-5"><%= job.jobcategory%></p>
            </div>
          </div>

          <div class="mb-4">
            <h3 class="h5 fw-bold text-white mb-3">Job Description</h3>
            <p class="text-white-50 lh-base"><%= job.jobdescription %></p>
          </div>

          <div class="mb-4">
            <h3 class="h5 fw-bold text-white mb-3">Skills Required</h3>
            <div class="d-flex flex-wrap gap-2 skills">
              <% var skillsArr = Array.isArray(job.skillsrequired) ?
              job.skillsrequired : (job.skillsrequired || '').split(','); for
              (var i = 0; i < skillsArr.length; i++) { %>
              <span><%= skillsArr[i].trim() %></span>
              <% } %>
            </div>
          </div>

          <div class="row align-items-center mb-4">
            <div class="col-md-6 mb-3">
              <p class="text-white-50 mb-1">
                <i class="fa-solid fa-calendar-alt me-2"></i>Apply By:
              </p>
              <p class="fw-bold text-white fs-5"><%= job.applyby %></p>
            </div>
            <div class="col-md-6 mb-3">
              <p class="text-white-50 mb-1">
                <i class="fa-solid fa-clipboard-user me-2"></i>Applications
                received:
              </p>
              <p class="fw-bold text-white fs-5"><%= job.applicants %></p>
            </div>
          </div>

          <div class="mb-4 text-white-50 fst-italic"><%= job.jobposted%></div>

          <!-- Bottom controls: edit/delete (left) and view applicants / apply (centered at very bottom) -->
          <div class="d-flex justify-content-between align-items-center mt-4">
            <div>
              <% if (locals.userEmail && job.posterEmail && job.posterEmail ===
              locals.userEmail) { %>
              <a
                href="/postjob/<%= job.id %>"
                class="btn btn-sm btn-warning me-2"
                >Edit</a
              >
              <!-- Trigger delete modal -->
              <button
                type="button"
                class="btn btn-sm btn-danger"
                data-bs-toggle="modal"
                data-bs-target="#deleteJobModal"
              >
                Delete
              </button>
              <% } %>
            </div>
            <div></div>
          </div>

          <div class="text-center mt-3">
            <% if (locals.userEmail && job.posterEmail && job.posterEmail ===
            locals.userEmail) { %>
            <a
              href="/applicants/<%= job.id %>"
              class="btn details btn-lg fw-bold apply-btn"
            >
              View Applicants
            </a>
            <% } else { %>
            <button
              type="button"
              class="btn details btn-lg fw-bold apply-btn"
              data-bs-toggle="modal"
              data-bs-target="#applyModal"
            >
              Apply Now
            </button>
            <% } %>
          </div>
          <%}%>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Job Confirmation Modal -->
<div
  class="modal fade"
  id="deleteJobModal"
  tabindex="-1"
  aria-labelledby="deleteJobModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content jobdetails-modal">
      <div class="modal-header jobdetails-modal-header">
        <h5 class="modal-title fw-bold text-white" id="deleteJobModalLabel">
          Confirm delete
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body text-white">
        <p>
          Are you sure you want to permanently delete this job posting? This
          action cannot be undone and all associated applicants will be removed.
        </p>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-light"
          data-bs-dismiss="modal"
        >
          Cancel
        </button>
        <form method="post" action="/deletejob/<%= job.id %>" class="m-0 p-0">
          <button type="submit" class="btn btn-danger">Yes, delete job</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Apply Now Modal -->
<div
  class="modal fade"
  id="applyModal"
  tabindex="-1"
  aria-labelledby="applyModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content jobdetails-modal">
      <div class="modal-header jobdetails-modal-header">
        <h5 class="modal-title fw-bold text-white" id="applyModalLabel">
          Apply for Full Stack Developer
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body text-white">
        <form
          id="applicationForm"
          method="post"
          action="/apply/<%= job.id %>"
          enctype="multipart/form-data"
        >
          <div class="mb-3">
            <label for="fullName" class="form-label">Full Name</label>
            <input
              type="text"
              class="form-control jobdetails-modal-input"
              id="fullName"
              name="fullName"
              placeholder="Enter your full name"
            />
          </div>
          <div class="mb-3">
            <label for="email" class="form-label">Email address</label>
            <input
              type="email"
              class="form-control jobdetails-modal-input"
              id="email"
              name="email"
              placeholder="name@example.com"
            />
          </div>
          <div class="mb-3">
            <label for="mobileNumber" class="form-label">Mobile Number</label>
            <input
              type="tel"
              class="form-control jobdetails-modal-input"
              id="mobileNumber"
              name="mobile"
              placeholder="e.g., +91 9876543210"
            />
          </div>
          <div class="mb-3">
            <label for="resume" class="form-label">Resume (PDF format)</label>
            <input
              class="form-control jobdetails-modal-input"
              type="file"
              id="resume"
              name="resume"
              accept=".pdf"
            />
          </div>
          <div class="d-grid mt-4">
            <button type="submit" class="btn details fw-bold apply-btn">
              Submit Application
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
